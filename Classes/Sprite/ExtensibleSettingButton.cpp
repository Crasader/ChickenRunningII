#include "ExtensibleSettingButton.h"#include "Sound.h"#include "Options.h"ExtensibleSettingButton::ExtensibleSettingButton():_backpackCallback(nullptr),_callback(nullptr),_selectIconTag(0),_isSelect(false) {}ExtensibleSettingButton::~ExtensibleSettingButton() {}void ExtensibleSettingButton::onTouchClickCallBack(Ref* pSender) {    log("touch ExtensibleSettingButton::onTouchClickCallBack");    Sound::getInstance()->playClick();        if (_isSelect) {        backpackIcon->unselected();        _isSelect = false;        backpackExtensibleBackground->setVisible(false);    } else {        backpackIcon->selected();        _isSelect = true;        backpackExtensibleBackground->setVisible(true);    }    if (_backpackCallback) {        _backpackCallback(this);    }    }void ExtensibleSettingButton::onReset() {    if (!Options::getInstance()->sound) {        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_soundMenuItem->getContentSize().width / 2,                         _soundMenuItem->getContentSize().height / 2);        _soundMenuItem->addChild(ban);    }        if (!Options::getInstance()->music) {        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_musicMenuItem->getContentSize().width / 2,                         _musicMenuItem->getContentSize().height / 2);        _musicMenuItem->addChild(ban);    }        if (!Options::getInstance()->shake) {        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_shakeMenuItem->getContentSize().width / 2,                         _shakeMenuItem->getContentSize().height / 2);        _shakeMenuItem->addChild(ban);    }}void ExtensibleSettingButton::onSound() {    Sound::getInstance()->playClick();    if (Options::getInstance()->sound) {        log("OptionsScene sound turned off");        Options::getInstance()->sound = 0;        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_soundMenuItem->getContentSize().width / 2,                         _soundMenuItem->getContentSize().height / 2);//        ban->setAnchorPoint(Vec2::ANCHOR_BOTTOM_LEFT);        _soundMenuItem->addChild(ban);    } else {        log("OptionsScene sound turned on");        Options::getInstance()->sound = 1;        _soundMenuItem->removeChildByTag(BackpackIconTag_Ban);    }}void ExtensibleSettingButton::onMusic() {    Sound::getInstance()->playClick();    if (Options::getInstance()->music) {        log("OptionsScene music turned off");        Options::getInstance()->music = 0;        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_musicMenuItem->getContentSize().width / 2,                         _musicMenuItem->getContentSize().height / 2);//        ban->setAnchorPoint(Vec2::ANCHOR_BOTTOM_LEFT);        _musicMenuItem->addChild(ban);                Sound::getInstance()->stopMusic();    } else {        log("OptionsScene music turned on");        Options::getInstance()->music = 1;        _musicMenuItem->removeChildByTag(BackpackIconTag_Ban);    }}void ExtensibleSettingButton::onShake() {    Sound::getInstance()->playClick();    if (Options::getInstance()->shake) {        log("OptionsScene shake turned off");        Options::getInstance()->shake = 0;        auto ban = Sprite::createWithSpriteFrameName("menu_setting_ban.png");        ban->setTag(BackpackIconTag_Ban);        ban->setPosition(_shakeMenuItem->getContentSize().width / 2,                         _shakeMenuItem->getContentSize().height / 2);//        ban->setAnchorPoint(Vec2::ANCHOR_BOTTOM_LEFT);        _shakeMenuItem->addChild(ban);    } else {        log("OptionsScene shake turned on");        Options::getInstance()->shake = 1;        _shakeMenuItem->removeChildByTag(BackpackIconTag_Ban);    }}void ExtensibleSettingButton::onTouchBackpackIconCallBack(Ref* pSender) {    MenuItemImage* target = dynamic_cast<MenuItemImage *>(pSender);    log("touch ExtensibleSettingButton::onTouchBackpackIconCallBack Tag:%d", target->getTag());    switch (target->getTag()) {        case BackpackIconTag_Shake: {            this->onShake();        }            break;        case BackpackIconTag_Sound: {            this->onSound();        }            break;        case BackpackIconTag_Music: {            this->onMusic();        }            break;                    default:            break;    }    _selectIconTag = target->getTag();        Options::getInstance()->save();        if (_callback) {        _callback(this);    }}void ExtensibleSettingButton::setCallback(const ccMenuCallback& callback) {    _callback = callback;}void ExtensibleSettingButton::setBackpackCallback(const ccMenuCallback& backpackCallback) {    _backpackCallback = backpackCallback;}bool ExtensibleSettingButton::init() {    Sprite* normalSprite = Sprite::createWithSpriteFrameName("menu_setting_icon.png");    Sprite* selectedSprite = Sprite::createWithSpriteFrameName("menu_setting_icon.png");        backpackIcon = MenuItemImage::create();    backpackIcon->setNormalImage(normalSprite);    backpackIcon->setSelectedImage(selectedSprite);    backpackIcon->setCallback(CC_CALLBACK_1(ExtensibleSettingButton::onTouchClickCallBack, this));    backpackIcon->setPosition(Vec2::ZERO);        auto menu = Menu::create(backpackIcon, NULL);    menu->setPosition(Vec2::ZERO);    this->addChild(menu, ExtensibleSettingButtonDrawingOrderIcon);        //锦囊背景    backpackExtensibleBackground = Sprite::createWithSpriteFrameName("menu_setting_bg.png");    backpackExtensibleBackground->setAnchorPoint(Vec2::ANCHOR_MIDDLE_LEFT);    backpackExtensibleBackground->setPosition(Point(Vec2::ZERO));    backpackExtensibleBackground->setVisible(false);    this->addChild(backpackExtensibleBackground, ExtensibleSettingButtonDrawingOrderBackgroundImage);     _shakeMenuItem = MenuItemImage::create();    normalSprite = Sprite::createWithSpriteFrameName("menu_setting_shake.png");    _shakeMenuItem->setNormalImage(normalSprite);    _shakeMenuItem->setSelectedImage(normalSprite);//    _shakeMenuItem->setAnchorPoint(Vec2::ANCHOR_MIDDLE_LEFT);    _shakeMenuItem->setPosition(Point(backpackExtensibleBackground->getContentSize().width / 4.0f,                                        backpackExtensibleBackground->getContentSize().height / 2));    _shakeMenuItem->setTag(BackpackIconTag_Shake);    _shakeMenuItem->setCallback(CC_CALLBACK_1(ExtensibleSettingButton::onTouchBackpackIconCallBack, this));    _soundMenuItem = MenuItemImage::create();    normalSprite = Sprite::createWithSpriteFrameName("menu_setting_sound.png");    _soundMenuItem->setNormalImage(normalSprite);    _soundMenuItem->setSelectedImage(normalSprite);//    _soundMenuItem->setAnchorPoint(Vec2::ANCHOR_MIDDLE_LEFT);    _soundMenuItem->setPosition(Point(backpackExtensibleBackground->getContentSize().width / 2.0f,                                      backpackExtensibleBackground->getContentSize().height / 2));    _soundMenuItem->setTag(BackpackIconTag_Sound);    _soundMenuItem->setCallback(CC_CALLBACK_1(ExtensibleSettingButton::onTouchBackpackIconCallBack, this));        _musicMenuItem = MenuItemImage::create();    normalSprite = Sprite::createWithSpriteFrameName("menu_setting_music.png");    _musicMenuItem->setNormalImage(normalSprite);    _musicMenuItem->setSelectedImage(normalSprite);//    _musicMenuItem->setAnchorPoint(Vec2::ANCHOR_MIDDLE_LEFT);    _musicMenuItem->setPosition(Point(backpackExtensibleBackground->getContentSize().width / 4.0f * 3,                                      backpackExtensibleBackground->getContentSize().height / 2));    _musicMenuItem->setTag(BackpackIconTag_Music);    _musicMenuItem->setCallback(CC_CALLBACK_1(ExtensibleSettingButton::onTouchBackpackIconCallBack, this));    auto backpackIconMenu = Menu::create(_shakeMenuItem, _soundMenuItem, _musicMenuItem, NULL);    backpackIconMenu->setPosition(backpackExtensibleBackground->getPosition());    backpackExtensibleBackground->addChild(backpackIconMenu, ExtensibleSettingButtonDrawingOrderIcon);        this->onReset();        return true;}void ExtensibleSettingButton::unSelected() {    if (_isSelect) {        backpackIcon->unselected();        backpackExtensibleBackground->setVisible(false);        _isSelect = false;    }}Size ExtensibleSettingButton::getExtensibleSettingButtonSize() {    return this->backpackIcon->getContentSize();}